---
import { getCollection } from 'astro:content';
import Link from './Link.astro';
import { SITE } from '../consts';

const intro = await getCollection('intro');
const introSlug = intro.map((item) => item.slug);
const contact = await getCollection('contact');
const contactSlug = contact.map((item) => item.slug);
---

<header id="header">
	<nav class="headerMenuArea">
		<h1 class="headerLogoBox">
			<a href="/" class="headerLogo">{SITE.name}</a>
		</h1>

		<ul class="headerMenuList">
			<li class="headerMenuItem">
				<Link href={`/intro/${introSlug}`} className="headerMenuLink" linkType="menuActive">소개</Link>
			</li>
			<li class="headerMenuItem">
				<Link href={`/contact/${contactSlug}`} className="headerMenuLink" linkType="menuActive">Contact</Link>
			</li>
			<li class="headerMenuItem">
				<button type="button" class="btnCommon" id="pwaInstall">바로가기 추가</button>
			</li>
		</ul>
	</nav>
</header>

<script>
let deferredPrompt;

window.addEventListener('beforeinstallprompt', event => {
    event.preventDefault();
    deferredPrompt = event;
});

const installApp = () => {
    if (!deferredPrompt) {
        alert('이미 앱이 설치되어 있거나 앱을 설치할 수 없는 환경입니다');
        return;
    }

    deferredPrompt.prompt();
}

const btn = document.getElementById('pwaInstall');

btn.addEventListener('click', installApp);
</script>